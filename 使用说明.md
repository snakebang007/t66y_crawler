# BBS图片爬虫程序使用说明

## 程序简介

这是一个基于Python和PyQt5开发的BBS图片爬虫程序，可以自动从指定的BBS帖子网址中提取并下载图片到本地。

## 功能特点

- 🌐 支持多种BBS网站的图片爬取
- 🖼️ 自动识别网页中的图片链接（包括JavaScript动态加载）
- 📁 可自定义图片保存路径
- 💾 **自动记忆上次选择的保存路径**
- 🪟 **自动记忆窗口位置和大小**
- 🔄 实时显示下载进度
- 🖥️ 网格形式预览下载的图片
- 📝 详细的操作日志记录
- 🧵 多线程下载，不阻塞界面

## 安装依赖

在运行程序前，请确保安装了所需的Python包：

```bash
pip install -r requirements.txt
```

或者手动安装：

```bash
pip install PyQt5==5.15.9
pip install requests==2.31.0
pip install beautifulsoup4==4.12.2
pip install Pillow==10.0.0
pip install lxml==4.9.3
```

## 运行程序

```bash
python3 main.py
```

## 使用步骤

1. **启动程序**
   - 运行 `python3 main.py` 启动程序
   - 程序窗口将显示主界面
   - **如果之前使用过，会自动加载上次的保存路径**

2. **输入网址**
   - 在顶部输入框中输入要爬取的BBS帖子网址
   - 支持大多数常见的BBS和论坛网站

3. **选择保存路径**
   - 如果是首次使用，点击"选择保存路径"按钮
   - 如果之前使用过，程序会自动加载上次的路径
   - 可以随时更改保存路径，新路径会被自动记住

4. **开始爬取**
   - 点击"开始爬取"按钮
   - 程序会自动分析网页并下载图片
   - 可以在进度条和状态栏看到实时进度

5. **查看结果**
   - 下载的图片会以网格形式显示在界面中
   - 每张图片都是150x150的缩略图
   - 鼠标悬停可以看到图片文件名
   - 底部日志区域显示详细的操作记录

## 新增功能 ✨

### 🔄 自动记忆功能

程序现在会自动记住您的使用习惯：

1. **保存路径记忆**
   - 每次选择保存路径后，程序会自动保存
   - 下次启动时会自动加载上次的路径
   - 配置文件位置：`~/.bbs_image_crawler/config.json`

2. **窗口位置记忆**
   - 程序会记住窗口的位置和大小
   - 下次启动时会在相同位置打开

3. **智能路径选择**
   - 选择新路径时，会从上次的路径开始浏览
   - 提高使用效率

### 📁 配置文件

程序的配置文件保存在：
```
~/.bbs_image_crawler/config.json
```

包含以下设置：
- `last_save_path`: 上次保存路径
- `window_geometry`: 窗口位置和大小
- `download_delay`: 下载延时
- `timeout`: 网络超时时间

## 程序结构

```
pachong/
├── main.py                 # 主程序入口
├── requirements.txt        # 依赖包列表
├── gui/                   # 界面模块
│   ├── __init__.py
│   └── main_window.py     # 主窗口界面
├── crawler/               # 爬虫模块
│   ├── __init__.py
│   └── image_crawler.py   # 图片爬虫核心
└── utils/                 # 工具模块
    ├── __init__.py
    ├── file_manager.py    # 文件管理工具
    └── config_manager.py  # 配置管理工具（新增）
```

## 支持的图片格式

- JPEG (.jpg, .jpeg)
- PNG (.png)
- GIF (.gif)
- BMP (.bmp)
- WebP (.webp)
- SVG (.svg)

## 图片识别技术

程序使用四种方法识别图片：

1. **传统img标签** - `<img src="...">`
2. **懒加载图片** - `<img data-src="...">`
3. **CSS背景图片** - `background-image: url(...)`
4. **JavaScript动态加载** - 正则表达式搜索页面内容

## 注意事项

1. **网络连接**：确保网络连接正常，程序需要访问目标网站
2. **访问权限**：某些网站可能有反爬虫机制，请合理使用
3. **存储空间**：确保选择的保存路径有足够的存储空间
4. **文件权限**：确保程序对选择的保存路径有写入权限
5. **合法使用**：请遵守网站的使用条款和相关法律法规
6. **配置文件**：不要手动删除配置文件，否则会丢失保存的设置

## 常见问题

**Q: 程序无法启动？**
A: 请检查是否正确安装了所有依赖包，特别是PyQt5。

**Q: 无法下载图片？**
A: 可能是网络问题或目标网站的反爬虫机制，请检查网络连接和网址是否正确。

**Q: 下载的图片不完整？**
A: 某些网站使用懒加载技术，程序会尽力获取所有可见的图片链接。

**Q: 程序运行缓慢？**
A: 为了避免对目标网站造成过大压力，程序在下载图片时会有0.5秒的延时。

**Q: 如何重置配置？**
A: 删除配置文件 `~/.bbs_image_crawler/config.json` 即可重置所有设置。

**Q: 保存路径没有被记住？**
A: 请确保程序对用户主目录有写入权限，配置文件需要保存在 `~/.bbs_image_crawler/` 目录下。

## 技术支持

如果遇到问题或有改进建议，请查看程序日志获取详细错误信息。 